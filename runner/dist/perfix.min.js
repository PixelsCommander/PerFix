function getURLParameterByName(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var s=new RegExp("[\\?&]"+t+"=([^&#]*)"),e=s.exec(location.href);return null==e?"":decodeURIComponent(e[1].replace(/\+/g," "))}!function(t){var s=20,e=function(t){this.id=t.id,this.name=t.name,this.before=t.before,this.action=t.action,this.timeout=t.timeout,this.delay=t.delay||0,this.group=t.group,this.index=t.index,this.statistics=void 0!==this.group?t.statistics:localStorage[this.name],this.currentDelay=0,this.result={},this.result.averageDelay=0,this.result.janksNumber=0,this.result.minDelay=0,this.result.maxDelay=0,this.delaySum=0,this.data=[],this.janks=[],this._lastFrameTime=0,this._currentFrameTime=0,this.tick=this.tick.bind(this),this.stop=this.stop.bind(this),this.initiateTest=this.initiateTest.bind(this)},i=e.prototype;i.test=function(){void 0!==this.before&&this.before(),document.body.offsetHeight,this.stopped=!1,setTimeout(this.initiateTest,this.delay)},i.initiateTest=function(){this.action(),requestAnimationFrame(this.tick),void 0!==this.timeout&&setTimeout(this.stop,this.timeout)},i.stop=function(){this.stopped=!0},i.tick=function(){this._currentFrameTime=performance.now(),0!==this._lastFrameTime&&(this.currentDelay=this._currentFrameTime-this._lastFrameTime,this.currentDelay>s&&this.addJunk(this.currentDelay),this.addData(this.currentDelay),this.result.minDelay=0===this.result.minDelay?this.currentDelay:Math.min(this.result.minDelay,this.currentDelay),this.result.maxDelay=Math.max(this.result.maxDelay,this.currentDelay)),this._lastFrameTime=this._currentFrameTime,this.stopped!==!0?requestAnimationFrame(this.tick):this.completed()},i.addData=function(t){this.data.push(parseFloat(t.toFixed(2))),this.delaySum+=t,this.result.averageDelay=this.delaySum/this.data.length},i.addJunk=function(t){this.janks.push(t),this.result.janksNumber++},i.completed=function(){this.updateStatistics(),this.group?this.group.testCompleted():this.saveResultToLocalStorage()},i.saveResultToLocalStorage=function(){JSON.stringify(this.statistics)},i.updateStatistics=function(){void 0===this.statistics||""===this.statistics?(this.statistics={},this.statistics.tries=0,this.statistics.averageDelaySum=0,this.statistics.janksNumberSum=0,this.statistics.minDelaySum=0,this.statistics.maxDelaySum=0,this.statistics.result={},this.statistics.result.averageDelay=0,this.statistics.result.janksNumber=0,this.statistics.result.minDelay=0,this.statistics.result.maxDelay=0):"string"==typeof this.statistics&&(this.statistics=JSON.parse(this.statistics)),this.statistics.tries++,this.statistics.averageDelaySum+=this.result.averageDelay,this.statistics.janksNumberSum+=this.result.janksNumber,this.statistics.minDelaySum+=this.result.minDelay,this.statistics.maxDelaySum+=this.result.maxDelay,this.statistics.result.averageDelay=this.statistics.averageDelaySum/this.statistics.tries,this.statistics.result.averageFPS=1e3/this.statistics.result.averageDelay,this.statistics.result.janksNumber=this.statistics.janksNumberSum,this.statistics.result.minDelay=this.statistics.minDelaySum/this.statistics.tries,this.statistics.result.maxDelay=this.statistics.maxDelaySum/this.statistics.tries},i.logTestResult=function(){console.group(this.name),console.log(this.result),console.log(this.data),console.log(this.statistics.result),console.groupEnd()},t.PerfomanceTest=e}(window),function(){if("undefined"==typeof window.performance&&(window.performance={}),!window.performance.now){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-t}}}(),function(t){var s=function(t){this.name=t.name,this.triesNumber=t.triesNumber,this.currentTry=t.currentTry,this.currentTestID=t.currentTestID,this.currentTestIndex=this.getTestIndex(this.currentTestID,t.testsDescription),this.currentTest=void 0,this.runner=t.runner,0===this.currentTry&&0===this.currentTestIndex&&this.resetLocalStorage(),this.statistics=this.getStatisticsFromLocalStorage(),this.tests=this.getTestsFromDescription(t.testsDescription)},e=s.prototype;e.test=function(){this.currentTest=this.getCurrentTest(),void 0!==this.currentTest&&this.currentTest.test()},e.getCurrentTest=function(){if(void 0!==this.currentTry&&void 0!==this.currentTestID)for(var t=0;t<this.tests.length;t++){var s=this.tests[t];if(s.id===this.currentTestID)return s}},e.getTestIndex=function(t,s){for(var e=0;e<s.length;e++){var i=s[e];if(i.id===t)return e}},e.testCompleted=function(){this.saveResultToLocalStorage(),this.logTestResult(),void 0!==this.runner&&this.runner.proceed()},e.saveResultToLocalStorage=function(){this.statistics=this.getStatisticsFromTests(),localStorage[this.name]=JSON.stringify(this.statistics)},e.logTestResult=function(){console.group(this.name);for(var t in this.statistics)if(void 0!==this.statistics[t]){console.group(t);var s=this.statistics[t].result;console.log(s),console.groupEnd(t)}console.groupEnd()},e.resetLocalStorage=function(){localStorage[this.name]=""},e.getStatisticsFromLocalStorage=function(){var t=localStorage[this.name];return void 0===t||"undefined"===t||""===t?{}:JSON.parse(t)},e.getTestsFromDescription=function(t){for(var s=[],e=0;e<t.length;e++){var i=t[e],r=this.statistics[i.name];i.statistics=r,i.group=this,i.index=e,s.push(new PerfomanceTest(i))}return s},e.getStatisticsFromTests=function(){for(var t={},s=0;s<this.tests.length;s++){var e=this.tests[s],i=e.name;t[i]=e.statistics}return t},e.getDataForControlStation=function(){var t={};t.triesNumber=this.triesNumber,t.name=this.name,t.tests=[];for(var s=0;s<this.tests.length;s++){var e=this.tests[s],i={};i.name=e.name,void 0!==e.statistics&&(i.averageFPS=1e3/e.statistics.result.averageDelay.toFixed(2),i.averageDelay=e.statistics.result.averageDelay.toFixed(2),i.janksNumber=e.statistics.result.janksNumber.toFixed(2),i.minDelay=e.statistics.result.minDelay.toFixed(2),i.maxDelay=e.statistics.result.maxDelay.toFixed(2)),this.currentTest.index>e.index&&(i.triesCompleted=this.triesNumber),this.currentTest.index<e.index&&(i.triesCompleted=0),this.currentTest.index===e.index&&(i.triesCompleted=this.currentTry),t.tests.push(i)}return t},t.PerformanceTestsGroup=s}(window),function(t){var s="tries",e="testid",i=function(){this.group={}},r=i.prototype;r.describe=function(t,s,e){var i={name:t,testsDescription:s,triesNumber:e,currentTry:this.getCurrentTry(),currentTestID:this.getCurrentTestID(),runner:this};this.group=new PerformanceTestsGroup(i),this.group.test()},r.getCurrentTestID=function(){var t=void 0,s=location.href.replace(/^.*[\\\/]/,"");return s=s.substr(0,s.lastIndexOf(".")),t=getURLParameterByName(e)||s},r.getCurrentTry=function(){return this.group.currentTry=parseInt(getURLParameterByName(s)),(void 0===this.group.currentTry||isNaN(this.group.currentTry))&&(this.group.currentTry=0),this.group.currentTry},r.runNextTry=function(){this.reOpen(this.group.currentTest,++this.group.currentTry)},r.proceed=function(){void 0!==t.Peer?this.sendStatToControlStation():this.runNextTry()},r.reOpen=function(t,e){var i=s+"="+e+"&";e>this.group.triesNumber?this.runNextTest():window.location.href=this.getURLFromTest(t)+"?"+i},r.runNextTest=function(){if(this.group.currentTest.index<this.group.tests.length-1){var t=this.group.tests[this.group.currentTest.index+1];this.reOpen(t,0)}else this.logFinalResult()},r.getURLFromTest=function(t){var s=location.href.substring(0,location.href.lastIndexOf("/")+1),e=t.id,i=t.URL,r=s+(i||e)+".html";return r},r.logFinalResult=function(){var t={value:0},s={value:0};for(var e in this.group.statistics){var i=this.group.statistics[e].result,r=e;0===t.value&&(t.value=i.averageDelay,t.name=r),0===s.value&&(s.value=i.janksNumber,s.name=r),t.value>i.averageDelay&&(t.value=i.averageDelay,t.name=r),s.value>i.janksNumber&&(s.value=i.janksNumber,s.name=r)}var a=t.name+" is most performant. "+s.name+" is less janky. Look for details in console.";alert(a)},r.sendStatToControlStation=function(){var t=new Peer({key:"pu0g0mdqm66zjjor"}),s=this;t.on("open",function(){var e=t.connect("perf-test-server-2");e.on("open",function(){var i=s.group.getDataForControlStation();e.send(JSON.stringify(i)),setTimeout(function(){s.runNextTry()},10),t.disconnect()})})},t.perfix=new i}(window);